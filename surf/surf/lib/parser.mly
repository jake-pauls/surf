%{
open Ast
%}

(** *.mly is the parser generated by Menhir *)

%token <int> INT
%token <float> FLOAT
%token <string> ID
%token PLUS MINUS MULT DIV
%token LPAREN RPAREN
%token COLON
%token SEMICOLON
%token LET
%token EQUALS
%token STINT STFLOAT
%token EOF

(** unary minus operators [ie: -1] are non-associative and have the highest precedence *)
%nonassoc UMINUS
%left MINUS PLUS
%left MULT DIV

(** the program - it returns an expression when it's complete *)
%start <Ast.expr option> prog

%%

prog:
    | EOF { None }
    | e = expr; EOF { Some e }
    ;

expr:
    | LPAREN; e = expr; RPAREN { e }
    | i = INT { Int i }
    | f = FLOAT { Float f }
    | x = ID { Var (x) }

    /* Expression Types */

    | MINUS; e = expr; %prec UMINUS { Unop (UMinus, e) }
    | e1 = expr; PLUS; e2 = expr { Binop (Add, e1, e2) }
    | e1 = expr; MINUS; e2 = expr { Binop (Minus, e1, e2) }
    | e1 = expr; MULT; e2 = expr { Binop (Mult, e1, e2) }
    | e1 = expr; DIV; e2 = expr { Binop (Div, e1, e2) }

    /* Assignment Rules */

    | LET; x = ID; COLON; t = stype; EQUALS; e = expr; SEMICOLON { Let (x, t, e) }
    ;

    /* Static Types */

stype:
    | STINT { STInt } 
    | STFLOAT { STFloat }
    ;